<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ecommerce</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery-1.11.0.min.js" type="text/javascript"></script>
</head>
<body style="background-image:url(https://img1.baidu.com/it/u=209763807,2539191806&fm=253&fmt=auto&app=138&f=JPEG?w=835&h=500)">
<div>
    <h1 class="p_title">在线商城</h1>
</div>
<div style="clear:both;"></div>
<div class="mdiv">
    <p class="p_head">查找商品</p>
    <div class="div_input">
        商品名<br/>
        <input class="input" type="text" name="title" id="title">
    </div>
    <div style="clear:both;">
        <button class="button" id="find" type="submit">搜索商品</button>
    </div>
</div>
<div class="wdiv">
    <table style="width:100%;">
        <thead>
        <tr>
            <th>&nbsp;</th>
            <!-- <th>编号</th> -->
            <th>商品名</th>
            <th>价格</th>
            <th>描述</th>
            <th>销量</th>
            <th>库存</th>
        </tr>
        </thead>
        <tbody id="container" style="text-align: center; background-color: aliceblue; cursor: pointer;">

        </tbody>
    </table>
</div>
</body>
<script>
    jQuery(document).ready(function() {
        $("#find").on("click", function() {
            var title = $("#title").val();

            if (title == null || title == "") {
                alert("商品名不能为空");
                return;
            }

            $.ajax({
                type:"POST",
                contentType:"application/x-www-form-urlencoded",
                url:"http://localhost:8087/item/find",
                data:{
                    "title":title,

                },
                xhrFields:{withCredentials:true},
                success:function(data) {
                    if (data.status == "success") {
                        alert("查找商品成功");
                        g_itemList = data.data;
                        reloadDom();
                    } else {
                        alert("查找商品失败，因为"+data.data.errorMessage);
                    }
                },
                error:function(data) {
                    alert("查找商品失败，因为" + data.responseText);
                }
            })
            return false;
        });
    });
    var g_itemList = [];
    // jQuery(document).ready(function(){
    //     $.ajax({
    //         type:"POST",
    //         url:"http://localhost:8087/item/find",
    //         xhrFields:{withCredentials:true},
    //         success:function(data){
    //             if (data.status=="success") {
    //                 g_itemList = data.data;
    //                 reloadDom();
    //             }else{
    //                 alert("获取商品信息失败，因为 "+data.responseText);
    //             }
    //         },
    //         error:function(data){
    //             alert("获取商品信息失败，因为 "+data.responseText);
    //         }
    //     });
    // });
    function reloadDom() {
        for (var i = 0; i < g_itemList.length; i++) {
            var itemVO = g_itemList[i];
            var dom = "<tr data-id='"+itemVO.id+"' id='itemDetail"+itemVO.id+"'><td><img src='"+itemVO.imgUrl+"' style=\"width:100px;height:auto;\"/></td><td>"+itemVO.title+"</td><td>"+itemVO.price+"</td><td>"+itemVO.description+"</td>" +
                "<td>"+itemVO.sales+"</td><td>"+itemVO.stock+"</td></tr>";
            $("#container").append($(dom));
            $("#itemDetail"+itemVO.id).on("click",function(e){
                window.location.href="getItem.html?id="+$(this).data("id");
            });
        }
    }
</script>
</html>